{% load staticfiles %}

{% block page %}
<script src="/static/js/jquery-1.10.2.js"></script>
<script src="http://www.openlayers.org/api/OpenLayers.js"></script>
<script type="text/javascript" src="https://js.stripe.com/v2/">
</script>
<script type="text/javascript">

Stripe.setPublishableKey("{{stripe_key}}");

 var stripeResponseHandler = function(status, response) {
	  var $form = $('#card-form');

	  if (response.error) {
	    // Show the errors on the form
	    $form.find('.card-errors').text(response.error.message);
	    $form.find('button').prop('disabled', false);
	  } else {
	    // response contains id and card, which contains additional card details
	    var token = response.id;
	    // Insert the token into the form so it gets submitted to the server
	    $form.append($('<input id="stripeToken" type="hidden" name="stripeToken" />').val(token));
	    // and submit
	    $form.get(0).submit();
	  }
	};

$( document ).ready(function() {
		
	$( "#card-form" ).submit(function(event) {
		var $form = $(this);
		
		$form.find("button").prop("disabled", true);
		
		Stripe.card.createToken($form, stripeResponseHandler)
		
		return false;
	});
	
});                      



</script>
<div id="card_cont" class="card_cont">
<body> 
<form action="" method="POST" id="card-form">{% csrf_token %}
  <div class="alert alert-info" style="margin:10px">
  <h4>Pay delivery</h4>
  <p>
  Submit your credit card information
  </p>
    {% for key, value in form.errors.items %}
      <p>{{ value }}</p>
      {% endfor %}
        <span class="card-errors">
  </span>
  </div>
  <div class="form-row">
    <label>
      <span>Card Number</span>
      <input type="text" size="20" data-stripe="number"/>
    </label>
  </div>

  <div class="form-row">
    <label>
      <span>CVC</span>
      <input type="text" size="4" data-stripe="cvc"/>
    </label>
  </div>

  <div class="form-row">
    <label>
      <span>Expiration (MM/YYYY)</span>
      <input type="text" size="2" data-stripe="exp-month"/>
    </label>
    <span> / </span>
    <input type="text" size="4" data-stripe="exp-year"/>
  </div>
  
  <button type="submit" class="btn btn-primary" style="width:100%">Submit Card Info & PAY!</button>
</form>
</div>
 

 
</body>

{% endblock page %}


